<form [formGroup]="stepperForm">
  <mat-horizontal-stepper linear #stepper>
    <!-- aceptar condiciones -->
    <mat-step [stepControl]="stepperForm.controls.step1" [editable]="false">
      <ng-template matStepLabel>Acepta las condiciones</ng-template>
      <mat-checkbox formControlName="step1"
        >He leído y acepto los
        <a
          href="https://www.smowltech.net/firma/conditions_GDPR_1_es.html"
          target="_blank"
          >términos y condiciones</a
        >.</mat-checkbox
      >
    </mat-step>

    <!-- habilitar camara -->
    <mat-step [stepControl]="stepperForm.controls.step2" [editable]="false">
      <ng-template matStepLabel>Habilita la cámara</ng-template>
      <p>
        Al hacer click en el botón, deberás aceptar un diálogo emergente.
      </p>
      <button
        mat-flat-button
        type="button"
        class="button primary-button inverse-button center-block"
        (click)="getCamAccess()"
      >
        SOLICITAR ACCESO
      </button>
    </mat-step>

    <!-- hacer fotos -->
    <mat-step
      #camStep
      [stepControl]="stepperForm.controls.step3"
      [editable]="true"
    >
      <ng-template matStepLabel>Hazte las fotos</ng-template>
      <app-picture-registration
        *ngIf="stepperForm.controls.step2.value"
        (complete)="
          this.images = $event; stepperForm.controls.step3.setValue(true)
        "
      ></app-picture-registration>
    </mat-step>

    <!-- confirmar fotos -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Confirma</ng-template>
      <ng-container [ngSwitch]="state">
        <app-gallery *ngSwitchCase="'default'" [images]="images"></app-gallery>
        <mat-spinner *ngSwitchCase="'loading'"></mat-spinner>
        <div *ngSwitchCase="'error'">
          <p id="error-message">
            Algo ha ido mal con tu registro. Por favor, repítelo.
          </p>
          <ul>
            <li>
              Asegúrate de que apareces centrado en el marco y mirándo a la
              cámara.
            </li>
            <li>
              Procura de que tu cara se vea claramente y que iluminación sea
              adecuada.
            </li>
            <li>Evita usar accesorios que cubran tu cara y cabeza.</li>
            <li>Debes estar sólo en las imágenes.</li>
          </ul>
        </div>
        <div *ngSwitchCase="'success'" id="success">
          <h2>¡Enhorabuena! Ya has terminado.</h2>
          <p>El proceso de registro se ha completado correctamente y tus datos ya están guardados en el sistema.</p>
        </div>
      </ng-container>
      <div id="buttons" *ngIf="state === 'default' || state === 'error'">
        <button
          matStepperPrevious
          type="button"
          mat-stroked-button
          class="button stroked-button inverse-button"
        >
          REPETIR FOTOS
        </button>
        <button
          *ngIf="state === 'default'"
          mat-flat-button
          color="accent"
          type="button"
          class="button primary-button inverse-button"
          (click)="validate()"
        >
          ENVIAR
        </button>
      </div>
    </mat-step>
  </mat-horizontal-stepper>
</form>
